apex.issues={},function(a){"use strict";function b(a){var b=a.toolbar.data;b[0].controls.unshift({type:"BUTTON",label:apex.lang.getMessage("APEX.ISSUES.JS.HEADING"),iconOnly:!0,icon:"fa fa-header",action:"addHeader"})}function c(a,b){var c=window.location.href.split("?")[0],d=$v("pInstance"),e=$v(b);return c+="?p=4600:100:"+d+":APPLICATION_PROCESS=getAttachment:NO::P100_ISSUE_ID,P100_FILE_NAME_SLUG:"+e+","+a}apex.issues={addHeadButton:b,replacePrefixImage:function(a,b){for(var d="(#ISSUE_FILE#",e=")",f=[],g=0;g<a.length;g++){var h=a.indexOf(d,g);if(h>=0){var i=a.indexOf(e,h+1);if(i<0){g=h+d.length;continue}var j=a.substring(h+d.length,i);f.push({imageName:j,path:c(j,b)}),g=i+1}else g=a.length}return f.forEach(function(b){a=a.replace(d+b.imageName+e,"("+b.path+")")}),a},addAttachButton:function(c,d,e,f){var g=$v(d);b(c),"Y"==g&&c.toolbar.data[c.toolbar.data.length-1].controls.unshift({type:"BUTTON",label:apex.lang.getMessage("APEX.ISSUES.JS.ATTACH_FILES"),iconOnly:!0,icon:"fa fa-paperclip",action:"attach_files"}),c.toolbar.actions.push({name:"attach_files",action:function(){var b="apexclosedialoginternal";window.location.assign($v(f)),apex.util.getTopApex().gPageContext$.off(b).on(b,function(b,c){var d,f,g,h,i,j,k,l="#ISSUE_FILE#";if(c&&c.P109_FILES_INFO){for(d=JSON.parse(c.P109_FILES_INFO),g=d.length,f=0;f<g;f++){h=d[f],i=h.n,j=l+h.slug,k=h.isImage?"!":"";var c=k+"["+i+"]("+j+")",m=apex.item(e),n=m.getValue();m.setValue(n+c)}a("#issueTimeline").trigger("apexrefresh")}})}})}}}(apex.jQuery);
!function(a,b,c,d,e,f){function g(a){return{getPreviewLabel:function(){return a.toolbar$.find('[data-action="preview"] label')},getPreviewInput:function(){return a.toolbar$.find('[data-action="preview"] input')},getActionContext:function(){return a.options.toolbar.actionsContext},setOption:function(a,b){this.getCodeMirror().setOption(a,b)},getValue:function(){return a.codeMirrorContainer.codeMirrorDocument.getValue()},getWrapperElement:function(){return a.codeMirrorContainer.codeMirror.getWrapperElement()},getCodeMirror:function(){return a.codeMirrorContainer.codeMirror},toggleAction:function(a){this.getActionContext().toggle(a)}}}function h(a){var b=g(a.editor);return{getCodeEditorInstance:function(){return a.getCodeEditorInstance()},refresh:function(){this.getCodeEditorInstance().refresh()},lineInfo:function(b){return a.getCodeEditorInstance().lineInfo(b)},setSize:function(b,c){return a.getCodeEditorInstance().setSize(b,c)},adjustHeight:function(){a.editor.codeMirrorContainer.adjustHeight()},getCodeMirror:function(){return b.getCodeMirror()}}}function i(a){var b='a:not([disabled]), button:not([disabled]), input[type=text]:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])';if(document.activeElement&&document.activeElement.form){var c=Array.prototype.filter.call(document.activeElement.form.querySelectorAll(b),function(a){return a.offsetWidth>0||a.offsetHeight>0||a===document.activeElement}),d=c.indexOf(document.activeElement);if(d>-1){var e=c[d+(a?-1:1)]||c[0];e.focus()}}}function j(a){var b=[];"BASIC"===a.whitelist?b=["b","i","u","em","strong","p","br"]:"IMAGE"===a.whitelist&&(b=["img"]);var c={preview:{parsing:{escapeInputHtml:"NONE"!==a.escapeInputHtml,htmlEscapeMode:E.C_EXTENDED_HTML_ESCAPE_MODE,htmlTagsWhitelisting:{enabled:"ALLOW_WHITELIST"===a.escapeInputHtml,allowAttributes:!0,whitelist:b},markedOptions:{gfm:!0,breaks:!0}},rendering:{highlightFencedCodeBlocks:!1}},designerOptions:a};return c}function k(a,b){var c=-1;try{c=parseInt(a.attr(b))}catch(d){console.log(d)}return c}function l(b,c){var d={};return d.refresh=function(){var a=h(b);a.refresh()},d.setStyleTo=function(){return b.editor.content$},d.setFocusTo=function(){return b.getCodeEditorInstance().focus(),a(this)},d.getValue=function(){return c.val()},d.setValue=function(a){var d=k(c,"maxlength");d>=0&&a.length>d||(b.setCodeEditorDocumentValue(a),b.getPreviewMode()&&q(!0,b.editor,b.onBeforePreviewText))},d}function m(a,b){var c=a.getCodeEditorInstance(),d=[];d.push({validate:function(a,c){var d=k(b,"maxlength");if(d>=0&&c.update){var e=c.text.join("\n"),f=e.length-(a.indexFromPos(c.to)-a.indexFromPos(c.from));if(f<=0)return!0;f=a.getValue().length+f-d,f>0&&(e=e.substr(0,e.length-f),c.update(c.from,c.to,e.split("\n")))}return!0}}),c.on("beforeChange",function(a,b){for(var c=0;c<d.length;c++){var e=d[c];e.validate(a,b)}})}function n(b,c){var d=j(c),e=this;e.onBeforePreviewText=function(a){return a};var f=a.extend({readOnly:{enabled:!1},textarea:{useCodeEditor:!0},designerOptions:c,markDownEditor:e},d);e.editor=new E.Editor(b,f),e.getCodeEditorInstance=function(){return e.editor.codeMirrorContainer.codeMirror},e.getPreviewMode=function(){return e.editor.showingPreview},e.setPreviewMode=function(a){p(e.editor,e.onBeforePreviewText)(a)},e.getCodeEditorDocument=function(){return e.editor.codeMirrorContainer.codeMirrorDocument},e.setCodeEditorDocumentValue=function(a){e.getCodeEditorDocument().setValue(a)},e.getCodeEditorDocumentValue=function(){return e.getCodeEditorDocument().getValue()},m(e,b),e.itemize=function(){return l(e,b)},c.readOnly&&p(e.editor,e.onBeforePreviewText)(!0)}function o(b){b.each(function(){var b=a(this);b.html(E.parse(b.text())).addClass(E.C_RENDERED_CLASS),a(document).trigger(E.C_EVENT_NAME,b.get(0))})}function p(a,b){return function(c){q(c,a,b)}}function q(b,c,d){var e,f;c.showingPreview=b,c.showingPreview?c.toolbar$.find('.a-Toolbar-item:not([data-action="preview"])').attr("disabled","disabled"):c.toolbar$.find('.a-Toolbar-item:not([data-action="preview"])').removeAttr("disabled");var g=G.getEditorUtils(c),e=g.getValue(),h=a(g.getWrapperElement());f=a(h).outerHeight();var i="";if(c.showingPreview){g.setOption("scrollbarStyle","null");var j=d(e);if(j.length>0)i=E.parse(j,c.options.preview.parsing);else{var k='<p style="color: #959595">'+c.getPreviewEmptyMessage()+"</p>";i=k}}else g.setOption("scrollbarStyle","native");c.previewPanel$.html(i).css("height",c.showingPreview?f:"").toggleClass("a-MDEditor-previewPanel--hide",!c.showingPreview).toggleClass(E.C_RENDERED_CLASS,c.showingPreview),c.showingPreview?(c.previewPanel$.hasScrollBar()&&c.previewPanel$.focus(),g.setOption("readOnly",!0)):g.setOption("readOnly",!1)}function r(a){var b=a.getSelectionProperties();return b.selectedText}function s(a,b,c){c=c||b;var d=r(a),e=d.substring(b.length,d.length-c.length);a.codeMirrorDocument.replaceSelection(e)}function t(a,b,c){c=c||b;var d=!1,e=r(a);return 0===e.indexOf(b)&&e.lastIndexOf(c)===e.length-c.length&&(d=!0),d}function u(a,b,c){c=c||b;var d=t(a,b,c);d?s(a,b,c):a.wrapSelection(b,c),a.adjustHeight()}function v(b){var c=a(b.target);setTimeout(function(){c.find("input").first().focus()},1)}function w(b,c){var d=[{name:"bold",action:function(){u(b.codeMirrorContainer,"**")}},{name:"italics",action:function(){u(b.codeMirrorContainer,"_")}},{name:"strikethrough",action:function(){u(b.codeMirrorContainer,"~~")}},{name:"inlineCode",action:function(){u(b.codeMirrorContainer,"```\n","\n```")}},{name:"addHeader",action:function(){b.codeMirrorContainer.prefixLines((b.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"# "),b.codeMirrorContainer.adjustHeight()}},{name:"unorderedList",action:function(){b.codeMirrorContainer.prefixLines((b.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"- "),b.codeMirrorContainer.adjustHeight()}},{name:"orderedList",action:function(){b.codeMirrorContainer.prefixLines((b.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"1. ",!0),b.codeMirrorContainer.adjustHeight()}},{name:"codeBlock",action:function(){var a=b.codeMirrorContainer.getSelectionProperties();b.codeMirrorContainer.wrapSelection((a.selectionStartsInZero?"":"\n\n")+"```\n","\n```"),b.codeMirrorContainer.adjustHeight()}},{name:"codeBlockHtml",action:function(){var a=b.codeMirrorContainer.getSelectionProperties();b.codeMirrorContainer.wrapSelection((a.selectionStartsInZero?"":"\n\n")+"```html\n","\n```"),b.codeMirrorContainer.adjustHeight()}},{name:"codeBlockCss",action:function(){var a=b.codeMirrorContainer.getSelectionProperties();b.codeMirrorContainer.wrapSelection((a.selectionStartsInZero?"":"\n\n")+"```css\n","\n```"),b.codeMirrorContainer.adjustHeight()}},{name:"codeBlockJs",action:function(){var a=b.codeMirrorContainer.getSelectionProperties();b.codeMirrorContainer.wrapSelection((a.selectionStartsInZero?"":"\n\n")+"```js\n","\n```"),b.codeMirrorContainer.adjustHeight()}},{name:"blockquote",action:function(){b.codeMirrorContainer.prefixLines((b.codeMirrorContainer.getSelectionProperties().selectionStartsInZero?"":"\n")+"> "),b.codeMirrorContainer.adjustHeight()}},{name:"link",action:function(){function c(){var a=e.input.val().trim(),c=g.input.val().trim();b.codeMirrorContainer.wrapSelection("["+a,"]("+c+")"),i.dialog("close").remove()}var d=b.codeMirrorContainer.getSelectionProperties(),e=E.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_LINK_TEXT",label:"Text",placeholder:"Link Description"}),g=E.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_LINK_URL",label:"URL",placeholder:"http://..."}),h=a("<form></form>").append(e.field).append(g.field);if(d.selectedText.match(/^[a-z]+:\/\//))b.codeMirrorContainer.wrapSelection("[](",")");else if(d.selectionLength>0)b.codeMirrorContainer.wrapSelection("[","]()");else{var i=h.dialog({autoOpen:!0,height:"auto",width:350,modal:!0,title:f.getMessage("APEX.MARKDOWN.INSERT_LINK"),buttons:{Cancel:function(){i.dialog("close").remove()},OK:c},focus:function(a,b){v(a)},close:function(){h.get(0).reset()},create:function(){a(this).parents(".ui-dialog").find(".ui-button:contains(OK)").addClass("ui-button--hot")}});x(i,c),i.parent().addClass("ui-dialog--markdown")}}},{name:"image",action:function(){function c(){var c,e,f="ORIGINAL",i=a("<img>").attr({src:h.input.val(),alt:g.input.val()});switch(f){case"SMALL":i.css({width:"30%"});break;case"MEDIUM":i.css({width:"50%"});break;case"LARGE":i.css({width:"100%"});break;case"ORIGINAL":}"ORIGINAL"===f?(c="!["+g.input.val(),e="]("+h.input.val()+")"):c=i.get(0).outerHTML+"\n",b.codeMirrorContainer.wrapSelection(c,e),d.dialog("close").remove()}var d,e=b.codeMirrorContainer.getSelectionProperties(),g=E.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_IMAGE_TEXT",label:"Text",placeholder:"Image Description"}),h=E.Editor.createTextInput({id:"MARKDOWNIFY_EDITOR_IMAGE_URL",label:"URL",placeholder:"http://..."}),i=a("<form></form>").append(g.field).append(h.field);e.selectedText.match(/^[a-z]+:\/\//)?b.codeMirrorContainer.wrapSelection("![](",")"):e.selectionLength>0?b.codeMirrorContainer.wrapSelection("![","]()"):(d=i.dialog({autoOpen:!0,height:"auto",width:400,modal:!0,title:f.getMessage("APEX.MARKDOWN.INSERT_IMAGE"),buttons:{Cancel:function(){d.dialog("close").remove()},OK:c},close:function(){i.get(0).reset()},focus:function(a,b){v(a)},create:function(){a(this).parents(".ui-dialog").find(".ui-button:contains(OK)").addClass("ui-button--hot")}}),x(d,c),d.parent().addClass("ui-dialog--markdown"))}},{name:"preview",get:function(){return b.showingPreview},set:p(b,c.onBeforePreviewText)}];return d}function x(b,c){b.on("keydown",function(b){switch(b.keyCode){case a.ui.keyCode.ENTER:c()}})}function y(){var a={};return a.preview={shortCut1:"Cmd-P",shortCut2:"Ctrl-P"},a.focusnext={shortCut1:"Shift-Cmd-.",shortCut2:"Shift-Ctrl-."},a.focusprev={shortCut1:"Shift-Cmd-,",shortCut2:"Shift-Ctrl-,"},a}function z(){var a={};return a.bold={shortCut1:"Cmd-B",shortCut2:"Ctrl-B"},a.italics={shortCut1:"Cmd-I",shortCut2:"Ctrl-I"},a.strikethrough={shortCut1:"Shift-Cmd-X",shortCut2:"Shift-Ctrl-X"},a}function A(a,b){var c=z(),d=c[a],e="APEX.MARKDOWN."+(b||a.toUpperCase());return B(e,d)}function B(a,b){var c=b.shortCut1,d=b.shortCut2;return f.getMessage(a)+" ("+(F?c:d)+")"}function C(a,b){function c(){return{type:"TOGGLE",labelKey:"APEX.MARKDOWN.PREVIEW",action:"preview"}}var d=[{type:"BUTTON",label:f.getMessage("APEX.MARKDOWN.LINK"),iconOnly:!0,icon:"icon-link",action:"link"},{type:"BUTTON",labelKey:"APEX.MARKDOWN.IMAGE",iconOnly:!0,icon:"icon-picture",action:"image"}],e=[{groupTogether:!0,controls:[{type:"BUTTON",label:A("bold"),iconOnly:!0,icon:"icon-bold",action:"bold"},{type:"BUTTON",label:A("italics","ITALIC"),iconOnly:!0,icon:"icon-italic",action:"italics"},{type:"BUTTON",label:A("strikethrough"),iconOnly:!0,icon:"icon-strikethrough",action:"strikethrough"},{type:"BUTTON",labelKey:"APEX.MARKDOWN.INLINE_CODE",iconOnly:!0,icon:"icon-code",action:"inlineCode"}]},{groupTogether:!0,controls:[{type:"BUTTON",labelKey:"APEX.MARKDOWN.UNORDERED_LIST",iconOnly:!0,icon:"icon-list-ul",action:"unorderedList"},{type:"BUTTON",labelKey:"APEX.MARKDOWN.ORDERED_LIST",iconOnly:!0,icon:"icon-list-ol",action:"orderedList"}]},{groupTogether:!0,controls:[{type:"BUTTON",label:"Blockquote",iconOnly:!0,icon:"icon-quote",action:"blockquote"}]},{groupTogether:!0,controls:d}];a.getReadOnlyMode()||e.push({groupTogether:!1,align:"end",controls:[c()]});var g=b.designerOptions.toolbar;return"SIMPLE"!=g&&"undefined"!=typeof g||d.pop(),"NONE"==g&&(e=[],a.getReadOnlyMode()||e.push({groupTogether:!1,align:"end",controls:[c()]})),e}function D(a,b){return{data:C(a,b),actions:w(a,b.markDownEditor),cursorKeyNavigation:!1}}var E={};E.version="1.0.0",E.C_RENDERED_CLASS="is-markdownified",E.C_EVENT_NAME="markdownified",E.C_BASIC_HTML_ESCAPE_MODE="B",E.C_EXTENDED_HTML_ESCAPE_MODE="E";var F=navigator.appVersion.indexOf("Mac")>=0;E.C_HTML_TAGS_WHITELIST=["b","strong","i","em","p","span","hr","h1","h2","h3","h4","h5","h6"],E.htmlEscapeMode=E.C_EXTENDED_HTML_ESCAPE_MODE,a.fn.hasScrollBar=function(){return!!this[0]&&this[0].scrollHeight>this.innerHeight()};var G={getEditorUtils:g,getMarkdownUtils:h};marked.setOptions({gfm:!0,sanitize:!1,silent:!1}),c.markdown=function(b,c){c=a.extend(!0,{initJavascriptCode:function(){},readOnly:!0},c);var d=a(b),f=new n(d,c),g=d.attr("id");return e.create(g,f.itemize()),f},c.markdown.render=function(b){var c=a(b);o(c)},E.parserOptions={escapeInputHtml:!0,htmlEscapeMode:E.htmlEscapeMode,htmlTagsWhitelisting:{enabled:!1,allowAttributes:!1,whitelist:E.C_HTML_TAGS_WHITELIST},markedOptions:{gfm:!0,breaks:!0,sanitize:!0}};var H=new marked.Renderer,I=H.link;H.link=function(a,b,c){var d=I.call(H,a,b,c);return d.replace(/^<a /,'<a target="_blank" ')},DOMPurify.setConfig({ADD_ATTR:["target"]}),E.parse=function(a,b){b="undefined"==typeof b||!!b;var c=marked(a,{renderer:H});return DOMPurify.sanitize(c,{SAFE_FOR_JQUERY:!0})},E.render=function(b){var c=a(b).filter(':not([data-markdown]), [data-markdown="true"]').filter(":not( ."+E.C_RENDERED_CLASS+" )");o(c)},E.CodeMirrorContainer=function(c){if(this.textarea$=a(c).filter("textarea").eq(0),this.textareaPollingInterval=null,this.codeMirror=null,this.codeMirrorDocument=null,!(this.textarea$.length>0))throw"ERROR: markdownify.Textarea: No textarea element was found in the passed argument. A textarea selector, element or jQuery object must be passed";var d="rtl"==a("html").attr("dir");this.codeMirror=b.fromTextArea(this.textarea$.get(0),{tokenTypeOverrides:{emoji:"emoji"},direction:d?"rtl":"ltr"}),this.codeMirrorDocument=this.codeMirror.getDoc(),this.codeMirror.setOption("mode","text/x-gfm"),this.codeMirror.setOption("lineWrapping",!0),this.codeMirror.on("change",function(a,b){a.save()})},E.CodeMirrorContainer.maximumHeight=320,E.CodeMirrorContainer.prototype.adjustHeight=function(a){if(void 0===a&&(a=E.CodeMirrorContainer.maximumHeight),null!==this.codeMirror){var b=this.codeMirror.getWrapperElement().offsetHeight,c=this.codeMirror.getScrollInfo().height;if(c>b&&b<a){var d=b+this.codeMirror.defaultTextHeight();this.codeMirror.setSize(null,d)}}},E.CodeMirrorContainer.prototype.getSelectionProperties=function(){var a,b,c=null;return this.codeMirror.execCommand("singleSelection"),b=this.codeMirrorDocument.listSelections()[0],a={selectionStart:b.anchor,selectionEnd:b.head,textareaValue:this.codeMirrorDocument.getValue(),textBeforeSelection:"",textAfterSelection:"",selectedText:this.codeMirrorDocument.getSelections()[0],selectionLength:0,numberOfSelectedLines:0,selectionStartsInZero:!1},a.selectionStartsInZero=0==a.selectionStart.line&&0==a.selectionStart.ch,a.selectionStart.ch>a.selectionEnd.ch&&(c=a.selectionStart,a.selectionStart=a.selectionEnd,a.selectionEnd=c),a.textBeforeSelection=this.codeMirrorDocument.getRange({line:0,ch:0},a.selectionStart),a.textAfterSelection=this.codeMirrorDocument.getRange(a.selectionEnd,{line:this.codeMirrorDocument.lastLine(),ch:this.codeMirrorDocument.getLine(this.codeMirrorDocument.lastLine()).length}),a.selectionLength=a.selectedText.length,a.numberOfSelectedLines=a.selectedText.split("\n").length,a},E.CodeMirrorContainer.prototype.wrapSelection=function(a,b){var c,d=this.getSelectionProperties();this.codeMirrorDocument.replaceSelection((a||"")+d.selectedText+(b||""),"end"),c=this.codeMirrorDocument.listSelections()[0],0==d.selectionLength&&this.codeMirrorDocument.setSelection({line:c.anchor.line,ch:c.anchor.ch-(b?b.length:0)},{line:c.anchor.line,ch:c.anchor.ch-(b?b.length:0)});var e=this;setTimeout(function(){e.codeMirror.focus()},1)},E.CodeMirrorContainer.prototype.prefixLines=function(a){var b=this.getSelectionProperties(),c=this;b.selectionLength>0&&(b.selectedText=b.selectedText.split("\n").join("\n"+a)),this.codeMirrorDocument.replaceSelection((a||"")+b.selectedText,"end"),setTimeout(function(){c.codeMirror.focus()},1)},E.Editor=function(b,c){function e(a){(a.ctrlKey||a.metaKey)&&80===a.which&&(m.toggleAction("preview"),m.getCodeMirror().focus(),a.preventDefault(),a.stopPropagation())}function f(a,b,c){var d=c.shortCut1,e=c.shortCut2;g(a,b,d),e&&g(a,b,e)}function g(a,b,c){var d={};d[c]=function(){b()},a.addKeyMap(d)}var h=this,j=c.markDownEditor;h.getPreviewEmptyMessage=function(){var a=c.designerOptions.previewEmptyMessage;return a.length>1&&(a=a.substring(1),a=a.substring(0,a.length-1)),a};var l=c.designerOptions.readOnly;h.getReadOnlyMode=function(){return l},h.options=a.extend(!0,{textarea:{},preview:{parsing:E.parserOptions},toolbar:D(h,c)},c),c.designerOptions.initJavascriptCode.call(j,h.options),h.showingPreview=!1,h.editor$=a("<div></div>").addClass("a-MDEditor apex-item-markdown-editor"),h.toolbar$=a("<div></div>").addClass("a-MDEditor-toolbar"),h.options.toolbar.actionsContext=d.createContext("apex.markdown.Editor.toolbar",h.toolbar$.get(0)),h.options.toolbar.actionsContext.add(h.options.toolbar.actions),h.previewPanel$=a("<div></div>").addClass("a-MDEditor-previewPanel a-MDEditor-previewPanel--hide");var m=G.getEditorUtils(h);if(h.previewPanel$.keydown(e),h.content$=a("<div></div>").addClass("a-MDEditor-content"),h.editorContainer$=h.content$,h.content$=a(b).filter("textarea").addClass("a-MDEditor-textarea").wrap(h.content$).parent().wrap(h.editor$).before(h.toolbar$).prepend(h.previewPanel$),h.codeMirrorContainer=new E.CodeMirrorContainer(b,h.options.textarea),h.getReadOnlyMode()===!1){for(var n=z(),o=y(),p=h.options.toolbar.actionsContext,q=0;q<h.options.toolbar.actions.length;q++){var r=h.options.toolbar.actions[q],s=h.codeMirrorContainer.codeMirror,t=n[r.name];t&&f(s,function(a){return function(){p.invoke(a)}}(r.name),t),"preview"===r.name&&f(s,function(){p.toggle("preview")},o.preview)}f(s,function(){i()},o.focusnext),f(s,function(){i(!0)},o.focusprev),h.toolbar$.toolbar(h.options.toolbar),m.getPreviewInput().keydown(e)}if(null!==h.codeMirrorContainer.codeMirror){var u={width:void 0,height:void 0},v=k(a(b),"rows");v>=0&&(u.height=h.codeMirrorContainer.codeMirror.defaultTextHeight()*(v+2));var w=k(a(b),"cols");if(w>=0){var x=a(b).closest(".a-MDEditor"),A=h.codeMirrorContainer.codeMirror.defaultTextHeight()*w,B=x.find(".a-Toolbar-groupContainer"),C=12;B.each(function(){C+=a(this).outerWidth()}),x.css("max-width",Math.max(A,C))}h.codeMirrorContainer.codeMirror.setSize(u.width,u.height),h.editor$.addClass("a-MDEditor--codeEditor"),h.codeMirrorContainer.textarea$.parents(".u-Form-itemWrapper").css({"flex-wrap":"wrap",position:"relative"})}},E.Editor.createTextInput=function(b){var c=a("<input />").addClass("text_field apex-item-text").attr({type:"text",id:b.id,name:b.id}),d=a("<div></div>").addClass("u-Form-itemWrapper").append(c),e=a("<div></div>").addClass("u-Form-inputContainer col col-null").append(d),f=a("<label></label>").addClass("u-Form-label").attr("for",b.id).text(b.label),g=a("<div></div>").addClass("u-Form-labelContainer col col-null").append(f),h=a("<div></div>").addClass("u-Form-fieldContainer rel-col  lto46434665622631032_0 apex-item-wrapper apex-item-wrapper--text-field").append(g).append(e);return"placeholder"in b&&e.attr("placeholder",b.placeholder),{field:h,label:f,input:c}}}(apex.jQuery,CodeMirror,apex.widget,apex.actions,apex.item,apex.lang);
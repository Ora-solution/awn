!function(a,b,c,d){"use strict";var e="disabled",f="is-active",g="."+f,h="apex-item-multi-remove",i="."+h,j="apex-item-multi-item",k="."+j,l="data-value",m="aria-expanded",n="apexPopupLovInputTrap",o=d.ui.keyCode,p=60;a.popupLov=function(q){function r(b){var c,d=!1,e=Q.val();q.enterable&&e!==M?c=e:b?(c=b,d=!0):c=null,M=e,Q.attr(m,"true"),K=!0,a.util.openPopupLov(J,c,d,q,function(a){a&&(M=a.d||a.v||a,q.multiple&&Q.val("")),Q.attr(m,"false"),K=!1}),J=!1}function s(a,b){var d=b||a;return"<li class='"+j+"' data-value='"+c.escapeHTMLAttr(a)+"'><span>"+c.escapeHTML(d)+"<button class='"+h+"' type='button' tabindex='-1' aria-label='"+apex.lang.formatMessage("APEX.POPUP_LOV.REMOVE_VALUE",d)+"'><span class='a-Icon icon-multi-remove'></span></button></span></li>"}function t(a){var b,c,d,e;if(c=q.extraOut)for(b in c)c.hasOwnProperty(b)&&(a?(d="",e=null):(d=c[b].initialValue,e=null,null!==d&&"object"==typeof d&&d.hasOwnProperty("d")&&(d=d.v,e=d.d)),$s(c[b].item,d,e))}function u(){var a,b;a=Q.data("popupLovModelName"),a&&(b=apex.model.get(a),b&&(b.setData([]),apex.model.release(a))),J=!0}function v(){w.refresh()}var w,x,y,z,A,B,C,D,E,F,G,H=o.RIGHT,I=o.LEFT,J=!1,K=!1,L=!1,M="",N=q.itemId,O=d("#"+c.escapeCSS(N)+"_lov_btn",apex.gPageContext$),P=O.parent(),Q=d("#"+c.escapeCSS(N),apex.gPageContext$),R=d("#"+c.escapeCSS(N)+"_HIDDENVALUE",apex.gPageContext$),S=d().add(O).add(Q).add(R),T=d().add(O).add(Q);q=d.extend({dependingOnSelector:null,pageItemsToSubmit:null,height:q.isPopup?280:380,width:null,isPopup:!1,display:"list",nullValue:"",dynamicDefault:!1,initialFetch:"empty",multiple:!1,separator:":",enterable:!1,incrementalSearch:!1,minSearchChars:0,displayColumn:null,iconColumn:null,extraOut:{},persistState:!0},q),q.width||q.isPopup||(q.width="grid"===q.display?500:300),void 0===q.nullDisplayValue&&(q.nullDisplayValue=q.nullValue),q.hasDisplayValue=!q.enterable&&q.displayColumn,Q.attr("role","combobox").attr("aria-autocomplete","list").attr(m,"false").attr("aria-haspopup","dialog"),q.multiple&&(D=Q.attr("placeholder"),y=Q.parent().parent(),"rtl"===y.css("direction")&&(H=o.LEFT,I=o.RIGHT),A=y.parent(),A.css("position","relative"),Q.css("flex-grow",0),B=function(){var a=A.width()-O.outerWidth(!0);y.css("max-width",a),z=a-parseInt(y.css("border-left-width"),10)-parseInt(y.css("border-right-width"),10)-parseInt(y.css("padding-left"),10)-parseInt(y.css("padding-right"),10)},a.util.onElementResize(A[0],function(){B(),w.afterModify()}),a.util.onVisibilityChange(A[0],function(b){b&&a.util.updateResizeSensors(A[0])}),B(),F=[],G=[],y.children().not(":last").each(function(){var a=d(this);F.push(a.attr(l)),G.push(a.text())}).remove(),y.click(function(a){var b=!1,c=d(a.target),e=c.closest(i),h=c.closest(k);w.isDisabled()||(e[0]?(w.removeValue(h.attr(l)),b=!0):h.find("input")[0]||(y.children(g).removeClass(f),h.addClass(f),b=!0),b&&setTimeout(function(){Q.focus()},1))}).keydown(function(a){var b=a.which,c=y.children(g);w.isDisabled()||(""===Q.val()?b===o.DELETE||b===o.BACKSPACE?(a.target!==Q[0]||b!==o.BACKSPACE||c[0]||(c=Q.parent().prev()),c[0]&&w.removeValue(c.attr(l))):b===I?c[0]?c.prev()[0]&&(c.removeClass(f),c.prev().addClass(f)):Q.parent().prev().addClass(f):b===H&&c[0]&&c.next()[0]&&(c.removeClass(f),c=c.next(),c.find("input")[0]||c.addClass(f)):q.enterable&&b===o.ENTER&&Q.val()&&(w.addValue(Q.val()),Q.val(""),a.stopPropagation()),b===o.ENTER&&a.preventDefault())}).focusin(function(a){y.addClass("is-focused"),"INPUT"!==a.target.nodeName.toUpperCase()&&Q.focus()}).focusout(function(a){y.removeClass("is-focused").children(g).removeClass(f),q.enterable&&Q.val()&&!K&&(w.addValue(Q.val()),Q.val(""))})),q.initialSearch="",J=!0,"value"!==q.initialFetch||q.multiple||(q.initialSearch=Q.val()),(q.pageItemsToSubmit||q.dependingOnSelector)&&(x=q.pageItemsToSubmit||"",q.dependingOnSelector&&(x.length>0&&(x+=","),x+=q.dependingOnSelector),q.itemsToSubmit=x.replace(/#/g,"").split(/\s*,\s*/)),q.itemsToSubmit&&(q.pluginTarget=Q[0]),q.isPopup&&!q.enterable?P.mousedown(function(a){0!==a.button||w.isDisabled()||(r(),a.preventDefault())}):O.click(function(){L||r(),L=!1}).mousedown(function(){K&&(L=!0)}),Q.keydown(function(a){var b,c=a.which,e=!1;c===o.DOWN||c===o.UP?r():c===o.ENTER?a.preventDefault():q.enterable||(e=!(c>=112&&c<=123||c>=33&&c<=46||c<32),e&&(a.ctrlKey||a.metaKey)&&{65:1,67:1,86:1,88:1,89:1,90:1}[c]&&(e=!1),e&&(b=d("#"+n),b[0]||(b=d("<input id='"+n+"' type='text' class='u-vh' aria-hidden='true' tabindex='-1'>")),b.insertAfter(Q).focus(),setTimeout(function(){var a=b.val();b.val(""),a.length>0?r(a):document.activeElement===b[0]&&Q.focus()},10)))}),O.on("focus",function(){Q.focus()}),E={enable:function(){S.prop(e,!1),Q.removeClass("apex_disabled"),q.multiple&&y.find(i).prop(e,!1)},disable:function(){S.prop(e,!0),Q.addClass("apex_disabled"),q.multiple&&y.find(i).prop(e,!0)},isDisabled:function(){return Q.prop(e)},show:function(){T.show()},hide:function(){T.hide()},refresh:function(){Q.trigger("apexbeforerefresh"),q.dynamicDefault?setTimeout(function(){w.setValue("TODO","To do")},900):w.setValue(q.nullValue,q.nullDisplayValue),t(!0),u(),Q.trigger("apexafterrefresh")},setValue:function(a,b){var e,f,g,h;if(q.multiple){if(f=c.toArray(a,q.separator),b&&(h=c.toArray(b,q.separator)),Q.val(""),y.children().not(":last").remove(),g="",""!==a){for(e=0;e<f.length;e++)g+=s(f[e],h?h[e]:null);Q.parent().before(d(g))}R.val(f.join(q.separator))}else q.hasDisplayValue?(R.val(a),b||a!==q.nullValue||(b=q.nullDisplayValue),Q.val(b)):Q.val(a)},addValue:function(a,b){var c,e;q.multiple&&(e=!0,y.children().not(":last").each(function(){var b=d(this).attr(l);if(b===a)return e=!1,!1}),e&&(c=d(s(a,b)),Q.parent().before(c),R.val(this.getValue().join(q.separator)),Q.change()))},removeValue:function(a){var b=[];q.multiple&&(y.children().not(":last").each(function(){var c=d(this).attr(l);c===a&&b.push(this)}),d(b).remove(),R.val(this.getValue().join(q.separator)),b.length&&Q.change())},isChanged:function(){var a=this.getValue();return d.isArray(a)&&(a=a.join(q.separator)),C!==a},getValue:function(){var a;return q.multiple?(a=[],y.children().not(":last").each(function(){a.push(d(this).attr(l))}),a):q.hasDisplayValue?R.val():Q.val()},afterModify:function(){var a,b,c,d,e,f;if(q.multiple){if(D&&Q.attr("placeholder",this.isEmpty()?D:""),c=Q.parent(),f=parseInt(c.css("margin-left"),10)+parseInt(c.css("margin-right"),10),a=b=z,!this.isEmpty())for(c=c.prev(),e=c.offset().top;(a-=c.outerWidth(!0),c=c.prev(),c.length)&&(d=c.offset().top,d===e);)e=d;a<p&&(a=b),Q.css("max-width",a-f)}},setFocusTo:function(){return Q},displayValueFor:function(a){var b,e,f;if(q.hasDisplayValue){if(q.multiple){if(e=c.toArray(a,q.separator),f=this.getValue(),f.length!==e.length)return a;for(b=0;b<e.length;b++)if(e[b]!==f[b])return a;return d.map(y.children().not(":last"),function(a){return d(a).text()}).join(", ")}if(a===this.getValue())return d(this.node).val()}return a},getPopupSelector:function(){return".ui-dialog-popuplov"},nullValue:q.nullValue,separator:q.multiple?q.separator:null},q.itemsToSubmit&&(E.reinit=function(a,b){return this.setValue(a,b,!0),function(){u()}}),b.create(N,E),w=apex.item(N),q.multiple&&(w.setValue(F,G,!0),w.afterModify()),M=Q.val(),C=w.getValue(),d.isArray(C)&&(C=C.join(q.separator)),q.dependingOnSelector&&d(q.dependingOnSelector).change(v),Q.on("apexrefresh",v)}}(apex.widget,apex.item,apex.util,apex.jQuery);
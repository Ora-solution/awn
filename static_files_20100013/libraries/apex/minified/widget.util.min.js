apex.widget.util={},function(a,b,c,d,e){"use strict";function f(a){var b;for(b=0;b<l.length;b++)if(l[b].el===a)return b;return null}a.cascadingLov=function(a,b,c,d){var f=e(a,apex.gPageContext$),g=f[0]?f[0].id:"lov",h=e.extend({optimizeRefresh:!0,queue:{name:g,action:"replace"}},d),i=!1;return h.refreshObject||(h.refreshObject=f),h.loadingIndicator||(h.loadingIndicator=f),h.optimizeRefresh&&(e(h.dependingOn,apex.gPageContext$).each(function(){if(apex.item(this).isEmpty())return i=!0,!1}),i)?(h.refreshObject.trigger("apexbeforerefresh"),e.isFunction(h.clear)&&h.clear(),f.change(),void h.refreshObject.trigger("apexafterrefresh")):(c.pageItems=e(c.pageItems,apex.gPageContext$).add(h.dependingOn),apex.server.plugin(b,c,h))};var g=13,h=40,i=38,j=9;a.openPopupLov=function(a,d,f,k,l){function m(a){s.resize()}function n(a,c,d,e){var f,g=!1,h=!1,i=q.getOption("fetchData");a.forceRefresh&&(g=!0,"none"!==k.initialFetch||a.typeAhead&&F||(h=!0),i.search=null,a.forceRefresh=!1),null!==c&&c!==i.search&&(i.search=c,g=!0),d&&e&&(d!==i.sortColumn||e!==i.sortDirection)&&(i.sortColumn=d,i.sortDirection=e,g=!0),g&&(f=b.escapeRegExp(i.search).replace(/[_%]/g,function(a){return"[^<>&]"+("%"===a?"*":"")}),s.options.highlighterContext={term:i.search,re:new RegExp("([<>&;])|("+f+")","ig")},E?c.length>=k.minSearchChars&&!h&&!a.typeAhead?(s._setOption("noDataMessage",D),q.clearData()):(s._setOption("noDataMessage",E),q.setData([]),i.search=null):a.typeAhead&&!F?(q.setData([]),i.search=null):q.clearData(),a.typeAhead=!1)}function o(){z.setItem("state",JSON.stringify(B))}function p(){var a;if(z=apex.storage.getScopedSessionStorage({prefix:I,usePageId:!0,useAppId:!0}),B={},"grid"===k.display&&(B.columnWidths={}),a=z.getItem("state"))try{a=JSON.parse(a),C||(B.width=parseInt(a.width,10)||k.width,B.height=parseInt(a.height,10)||k.height),a.sortDirection&&/^(asc|desc)$/.test(a.sortDirection)&&(B.sortDirection=a.sortDirection),k.columns[a.sortColumn]&&(B.sortColumn=a.sortColumn),e.each(a.columnWidths,function(a,b){b=parseInt(b,10),b&&(B.columnWidths[a]=b)})}catch(b){}}var q,r,s,t,u,v,w,x,y,z,A=b.getTopApex().jQuery,B=null,C=k.isPopup||!1,D=c.getMessage("APEX.POPUP_LOV.NO_RESULTS"),E=null,F=k.incrementalSearch,G=k.initialSearch||"",H=e("#"+k.itemId),I="PopupLov_"+e("#pFlowStepId").val()+"_"+k.itemId,J=I+"_dlg",K=null;k.persistState&&p(),y=function(){return"<div class='a-PopupLOV-dialog'></div>"},H.data("popupSearchState",{forceRefresh:a,typeAhead:f,searchText:d}),t=A("#"+J),!t[0]&&B&&(k.width=B.width||k.width,k.height=B.height||k.height,B.sortColumn&&B.sortDirection&&e.each(k.columns,function(a,b){a===B.sortColumn&&b.canSort?(b.sortIndex=1,b.sortDirection=B.sortDirection):(delete b.sortIndex,delete b.sortDirection)}),e.each(B.columnWidths,function(a,b){k.columns[a].width=b})),u={id:J,title:k.title||c.getMessage("APEX.POPUP_LOV.TITLE"),isPopup:C,parentElement:C?H.closest(".apex-item-group--popup-lov"):null,returnFocusTo:H[0],noOverlay:!0,draggable:!0,resizable:!0,width:200,height:k.height,okButton:!1,dialogClass:"ui-dialog-popuplov",callback:function(){var a,b,c,d,e="setValue",f=apex.item(k.itemId);if(k.multiple&&(e="addValue"),K&&("object"==typeof K&&K.hasOwnProperty("d")&&K.hasOwnProperty("v")?f[e](K.v,K.d):"object"==typeof K&&K.hasOwnProperty("v")?f[e](K.v):f[e](K),!k.multiple&&(a=k.extraOut)))for(b in a)a.hasOwnProperty(b)&&(c=K[b],d=null,null!==c&&"object"==typeof c&&c.hasOwnProperty("d")&&(c=c.v,d=c.d),$s(a[b].item,c,d));s.setSelectedRecords([],!1),l&&l(K)},init:function(l){function m(a){return a.match(/^[A-Z0-9_$#]+$/)?"&"+a+".":'&"'+a+'".'}function p(){var a=s.getSelectedRecords()[0];a&&(K={v:q.getValue(a,k.valueColumn)},k.hasDisplayValue&&k.displayColumn&&(K.d=q.getValue(a,k.displayColumn)),k.extraOut&&Object.keys(k.extraOut).forEach(function(b){K[b]=q.getValue(a,b)}),l[S]("close"))}function t(){K={v:k.nullValue,d:k.nullDisplayValue},k.extraOut&&Object.keys(k.extraOut).forEach(function(a){K[a]=""}),l[S]("close")}function u(a,b,c){var d=null;return!a.term||c&&c.canSearch===!1?b:b.replace(a.re,function(a,b,c){if(b){switch(b){case"<":d=b;break;case">":"<"===d&&(d=null);break;case"&":d||(d=b);break;case";":"&"===d&&(d=null)}return b}return d||!c.length?c:"<span class='popup-lov-highlight'>"+c+"</span>"})}var y,z,A,J,L,M,N,O,P=null,Q=null,R=I+"_m",S=l.is(":data(apexPopup)")?"popup":"dialog",T=c.getMessage("APEX.POPUP.SEARCH"),U={forceRefresh:a,typeAhead:f,searchText:G||d},V=b.htmlBuilder();if(H.data("popupSearchState",U),V.markup("<div><div").attr("class","a-PopupLOV-searchBar"+(F?" a-PopupLOV--incremental":"")).markup("><input type='text' aria-label='"+T+"' maxlength='100' class='a-PopupLOV-search apex-item-text'").attr("value",G).markup(">"),F||V.markup("<button type='button' class='a-Button a-PopupLOV-doSearch' aria-label='"+T+"'>"),V.markup("<span class='a-Icon icon-search' aria-hidden='true'></span>"),F||V.markup("</button>"),V.markup("</div>"),k.nullDisplayValue&&V.markup("<div class='a-PopupLOV-clear'><button class='a-PopupLOV-clearButton' type='button'>").content(k.nullDisplayValue).markup("</button></div>"),V.markup("<div class='a-PopupLOV-results'></div></div></div>"),N=e(V.toString()),r=N.find(".a-PopupLOV-results"),v=N.find(".a-PopupLOV-searchBar"),w=v.find(".a-PopupLOV-search"),O=v.find(".a-PopupLOV-doSearch"),x=N.find(".a-PopupLOV-clearButton"),e.each(k.columns,function(a,b){if(b.sortIndex)return P=a,Q=b.sortDirection,!1}),q=apex.model.create(R,{shape:"table",hasTotalRecords:!1,recordIsArray:!0,identityField:k.valueColumn,metaField:k.columns._meta?"_meta":null,fields:k.columns,paginationType:"progressive",regionId:k.itemId,fetchData:{search:null,sortColumn:P,sortDirection:Q},requestOptions:k.pluginTarget?{target:k.pluginTarget}:null,ajaxIdentifier:k.ajaxIdentifier,pageItemsToSubmit:k.itemsToSubmit},[],0,!1),H.data("popupLovModelName",R),L=k.displayColumn||k.valueColumn,"grid"===k.display)k.columns[L].usedAsRowHeader=!0,k.iconColumn&&(J="<span class='"+m(k.iconColumn)+"'></span> "+m(L),k.columns[L].cellTemplate=J),y=e.extend({modelName:R,columns:[k.columns],columnSort:!0,columnSortMultiple:!1,collapsibleControlBreaks:!1,footer:!1,hasSize:!0,noDataMessage:D,multiple:!1,pagination:{scroll:!0,loadMore:!0},constrainNavigation:!1,reorderColumns:!1,resizeColumns:!0,tooltip:null,highlighter:u,activateCell:function(a){var b=e(a.target).closest(".a-GV-cell");"keydown"===a.type&&a.which!==g||b.hasClass("a-GV-selHeader")||b.hasClass("has-button")||p()},selectionChange:function(a){a.originalEvent&&"click"===a.originalEvent.type&&p()},sortChange:function(a,b){var c,d,e,f=b.column.sortIndex,g=A.grid("getColumns");for(e=1,c=0;c<g.length;c++)d=g[c],d.sortIndex&&("change"===b.action?d===b.column&&(e=d.sortIndex):"add"===b.action?d.sortIndex>=e&&(e=d.sortIndex+1):"remove"===b.action?d===b.column?(delete d.sortIndex,delete d.sortDirection):d.sortIndex>f&&(d.sortIndex-=1):"clear"!==b.action&&"set"!==b.action||(delete d.sortIndex,delete d.sortDirection));"clear"!==b.action&&"remove"!==b.action&&(b.column.sortIndex=e,b.column.sortDirection=b.direction),A.grid("refreshColumns"),n(U,null,b.column.property,b.direction),B&&(B.sortColumn=b.column.property,B.sortDirection=b.direction,o())},columnResize:function(a,b){B&&(B.columnWidths[b.column.property]=parseInt(b.width,10),o())}},k.defaultGridOptions),A=r,A.grid(y),s=A.data("apex-grid"),A.click(function(a){var b=e(a.target).closest(".a-GV-row");b.hasClass("is-selected")&&p()});else{if("list"!==k.display)throw new Error("Invalid display value");J=k.recordTemplate,J?J=J.replace("&DISPLAY.","&"+L+".").replace("&ICON.","&"+k.iconColumn+".").replace("&RETURN.","&"+k.valueColumn+"."):(J="<li data-id='"+m(k.valueColumn)+"'>",k.iconColumn&&(J+="<span class='"+m(k.iconColumn)+"'></span> "),J+=m(L)+"</li>"),z=e.extend({modelName:R,recordTemplate:J,footer:!1,hasSize:!0,noDataMessage:D,highlighter:u,useIconList:!0,constrainNavigation:!1,iconListOptions:{navigation:!0,multiple:!1,activate:function(a){p(),a.preventDefault()}},pagination:{scroll:!0,loadMore:!0}},k.defaultIconListOptions),r.tableModelView(z),s=r.data("apex-tableModelView")}l.append(N.children()),k.minSearchChars>0&&(E=c.formatMessage("APEX.POPUP_LOV.FILTER_REQ",k.minSearchChars)),E||"none"!==k.initialFetch||(E=c.getMessage("APEX.POPUP_LOV.INITIAL_FILTER_REQ")),F&&(M=b.debounce(function(){n(U,w.val())},400)),r.keydown(function(a){var b=a.which;a.isDefaultPrevented()||(b===h?w.focus():b===i&&x.add(w).last().focus())}).focusin(function(){var a=s.getSelection();0===a.length&&(a=e(r[0].ownerDocument.activeElement).closest(".a-IconList-item,.a-GV-row"),a[0]&&s.setSelection(a))}),w.keydown(function(a){var b,c=a.which;c===h?(x[0]?x.focus():s.focus(),a.preventDefault()):c===i?(s.focus(),a.preventDefault()):c===j&&F?1===q.getTotalRecords()&&(A?A.grid("setSelection",A.find(".a-GV-cell").eq(0)):s.focus(),p(),a.preventDefault(),a.stopPropagation()):c===g?(a.preventDefault(),F&&k.enterable&&C&&w.val()?(K={v:w.val()},l[S]("close")):F&&!k.enterable&&1===q.getTotalRecords()?(b=null,q.forEach(function(a){b=a}),b&&(s.setSelectedRecords([b]),p())):n(U,w.val())):F&&M()}),O.click(function(){n(U,w.val())}),x.click(function(){t()}).keydown(function(a){var b=a.which;b===h?(s.focus(),a.preventDefault()):b===i&&(w.focus(),a.preventDefault())})},open:function(a){var b,c,d,f,g=H.data("popupSearchState"),h=g.searchText||"",i=A(a.target),j=i.is(":data(apexPopup)")?"popup":"dialog";k.width||(b=H.closest(".apex-item-group--popup-lov").width()),C&&(d=e(window).width()-10,f=e(window).height()-10,(k.width||b)>d&&(b=d),k.height>f&&(c=f)),b&&i[j]("option","width",b),c&&i[j]("option","height",c),m(a.target),K=null,(h||g.forceRefresh)&&(w.val(h),n(g,h)),w.focus()},resize:function(a){m(a.target)},resizeStop:function(a,b){B&&!C&&(B.height=b.size.height,B.width=b.size.width,o())}},["draggable","resizable","width","height","minWidth","minHeight","maxWidth","maxHeight","noOverlay"].forEach(function(a){void 0!==k[a]&&(u[a]=k[a])}),apex.message.showDialog(y,u)};var k=function(a,b){a.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),"label-desc"===b&&a.reverse()};a.chartSortArray=k,a.chartFillGaps=function(a,b,c,d){k(b,c);for(var e=0;e<a.length;e++)b[e]&&b[e].name===a[e].name?b[e].id!==e&&(b[e].id=e):b.splice(e,0,{name:a[e].name,value:d?0:null})},a.enableIcon=function(a,b,c){a.find("img").css({opacity:1,cursor:""}).parent("a").attr("href",b),c&&a.click(c)},a.disableIcon=function(a){a.find("img").css({opacity:.5,cursor:"default"}).parent("a").removeAttr("href").unbind("click")};var l=[];a.onVisibilityChange=function(a,b){var c=f(a),d={el:a,cb:b};null!==c?l[c]=d:l.push(d)},a.offVisibilityChange=function(a){var b=f(a);null!==b&&l.splice(b,1)};var m=a.visibilityChange=function(a,b){var c,d,f,g=e(a);for(b=!!b,c=0;c<l.length;c++)f=l[c],d=e(f.el),b===d.is(":visible")&&d.closest(g).length&&f.cb(b)};e(document.body).on("apexaftershow",function(a){m(a.target,!0)}).on("apexafterhide",function(a){m(a.target,!1)});var n="apex-resize-sensor";a.onElementResize=function(a,b){var c,d;"string"==typeof a&&(a="#"+a),c=e(a).first(),d=c.data(n),d||(d=new o(c[0]),c.data(n,d),d.start()),d.addListener(b)},a.offElementResize=function(a,b){var c,d;"string"==typeof a&&(a="#"+a),c=e(a).first(),d=c.data(n),d&&(b?(d.removeListener(b),d.isEmpty()&&(d.stop(),c.removeData(n))):(d.destroy(),c.removeData(n)))},a.updateResizeSensors=function(a){"string"==typeof a&&(a="#"+a),e(a).find(".js-resize-sensor").parent().each(function(a,b){var c=e(b).data(n);null!=c&&c.init(!0)})};var o=function(a){function c(a){var b=!1;if(null!=o.offsetParent){var c=o.offsetWidth,e=o.offsetHeight;m===c&&n===e||(k=j,h(c,e),b=!0,a&&d(!0))}return b}function d(c){var d=a.offsetWidth,e=a.offsetHeight;i.has()&&(c?(null!==l&&b.cancelInvokeAfterPaint(l),l=b.invokeAfterPaint(function(){l=null,i.fire(d,e)})):i.fire(d,e))}function f(a){a.stopPropagation(),c(!0)||k>0&&null!=o.offsetParent&&(0==o.scrollLeft||0==o.scrollTop)&&(k--,h(m,n))}function g(){d(!1)}function h(a,b){m=a,n=b;var c=o.firstChild.style,d=1;do c.width=a+d+"px",c.height=b+d+"px",o.scrollLeft=o.scrollTop=d,d++;while((0==o.scrollTop||0==o.scrollLeft)&&d<=5);p.scrollLeft=a,p.scrollTop=b}var i=e.Callbacks(),j=2,k=0,l=null,m=null,n=null,o=null,p=null,q=null,r=null;this.addListener=function(a){i.add(a)},this.removeListener=function(a){i.remove(a)},this.isEmpty=function(){return!i.has()},this.destroy=function(){i.empty(),this.stop()},this.start=function(){function b(a,b){a.direction="ltr",a.position=b.position="absolute",a.left=a.top=a.right=a.bottom="0",a.overflow="hidden",a.zIndex="-1",a.visibility="hidden",b.left=b.top="0",b.transition="0s"}if(r=f.bind(this),a.attachEvent)q=g.bind(this),a.attachEvent("onresize",q);else{var c=a.childNodes[0];o=document.createElement("div"),o.className="js-resize-sensor";var d=document.createElement("div");b(o.style,d.style),o.appendChild(d),c?a.insertBefore(o,c):a.appendChild(o),o.addEventListener("scroll",r,!1),p=document.createElement("div");var e=document.createElement("div");b(p.style,e.style),e.style.width="200%",e.style.height="200%",p.appendChild(e),a.insertBefore(p,o),p.addEventListener("scroll",r,!1),this.init(!1)}},this.stop=function(){null!==l&&(b.cancelInvokeAfterPaint(l),l=null),null!==o?(o.removeEventListener("scroll",r),p.removeEventListener("scroll",r),o.parentNode&&a.removeChild(o),p.parentNode&&a.removeChild(p)):a.detachEvent("onresize",q)},this.init=function(a){var b=c(a);a&&!b&&null!=o.offsetParent&&h(m,n)}};a.TouchProxy=function(a){this._init(a)},a.TouchProxy.prototype._init=function(a){this._elem=a,this._touchHandled=!1,this._touchMoved=!1,this._touchStartHandler=e.proxy(this._touchStart,this),this._touchEndHandler=e.proxy(this._touchEnd,this),this._touchMoveHandler=e.proxy(this._touchMove,this),this._elem.on({touchstart:this._touchStartHandler,touchend:this._touchEndHandler,touchmove:this._touchMoveHandler,touchcancel:this._touchEndHandler})},a.TouchProxy.prototype._destroy=function(){this._elem&&this._touchStartHandler&&(this._elem.off({touchstart:this._touchStartHandler,touchmove:this._touchMoveHandler,touchend:this._touchEndHandler,touchcancel:this._touchEndHandler}),this._touchStartHandler=void 0,this._touchEndHandler=void 0,this._touchMoveHandler=void 0)},a.TouchProxy.prototype._touchHandler=function(a,b){if(!(a.originalEvent.touches.length>1)){"touchstart"!=a.type&&"touchend"!=a.type&&a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvent");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),c.target.dispatchEvent(d)}},a.TouchProxy.prototype._touchStart=function(a){this._touchHandled||(this._touchHandled=!0,this._touchMoved=!1,this._touchHandler(a,"mouseover"),this._touchHandler(a,"mousemove"),this._touchHandler(a,"mousedown"))},a.TouchProxy.prototype._touchMove=function(a){this._touchHandled&&(this._touchMoved=!0,this._touchHandler(a,"mousemove"))},a.TouchProxy.prototype._touchEnd=function(a){this._touchHandled&&(this._touchHandler(a,"mouseup"),this._touchHandler(a,"mouseout"),this._touchHandled=!1)},a.TouchProxy._TOUCH_PROXY_KEY="apexTouchProxy",a.TouchProxy.prototype.touchMoved=function(){return this._touchMoved},a.TouchProxy.addTouchListeners=function(b){var c=e(b),d=c.data(a.TouchProxy._TOUCH_PROXY_KEY);return d||(d=new a.TouchProxy(c),c.data(a.TouchProxy._TOUCH_PROXY_KEY,d)),d},a.TouchProxy.removeTouchListeners=function(b){var c=e(b),d=c.data(a.TouchProxy._TOUCH_PROXY_KEY);d&&(d._destroy(),c.removeData(a.TouchProxy._TOUCH_PROXY_KEY))}}(apex.widget.util,apex.util,apex.lang,apex.navigation,apex.jQuery);
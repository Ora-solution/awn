$(function(){"use strict";!function(a,b,c,d,e,f){var g=$v("pInstance"),h=$v("F4000_P1_FLOW")||$v("P4500_CURRENT_APP"),i=a(x+y).length>0,j="",k=$v("pFlowId"),l=[],m=[],n=[],o="",p=!1,q=!1,r=apex_img_dir+"apex_ui/js/staticData/apex_search_common_en.json",s=apex_img_dir+"apex_ui/js/staticData/apex_search_common_"+apex.locale.getLanguage()+".json",t=[20,49,56,57,73,76,78,160,163,196,224,226,227,273,279,433,441,460,479,494,495,514,516,523,527,559,588,589,598,650,680,689,722,733,800,875,876,933,934,1500,2100,2101,2102,2103,2104,2105,2106,2107,2108,2109,2111,2115,2116,2117,2150,2151,2152,2153,2154,2155,2157,3e3,3001,3005,3020,4460,4900];if(window.self!==window.top||"4050"===k)return!1;if("undefined"!=typeof pe)var u=pe;var v={redirect:"redirect",searchPage:"search-page",searchApp:"search-app",searchAllApps:"search-all-apps",go2Page:"goto-page",go2App:"goto-app",pe:"pe",shortcutAction:"shortcutAction"},w={app:"icon-edit-app",page:"icon-page",search:"icon-search",shared:"icon-shared-components",nav:"icon-goto-group",pe:"icon-page-designer"},x=".",y="a-Spotlight",z="a-Spotlight-input",A="a-Spotlight-results",B="is-active",C="a-Spotlight-shortcut",D="spotlight-search",E="a-Spotlight-label",F="sp-aria-match-found",G="sp-result-list",H=a.ui.keyCode,I=100,J=50,K=80,L=function(){var a={4e3:"builder",4500:"builder",4800:"teamdev",4350:"admin"};return a[k]}(),M=function(){var a=window.location.search.substring(1),b=a.replace("p=","").split(":");return"4000"!==b[0]||t.includes(parseInt(b[1]))?"":apex.builder.gApplicationId};h.length<=0&&(h=M());var N,O=d.formatMessage,P={app:d.getMessage("SL.APP"),page:d.getMessage("SL.PAGE"),placeHolder:d.getMessage("SL.PLACEHOLDER"),oneMatchFound:d.getMessage("SL.MATCH.FOUND"),noMatchFound:d.getMessage("SL.NO.MATCH.FOUND"),enterKeywords:d.getMessage("SL.SEARCH.HELP")},Q=function(a){var b;return b=isNaN(a.split(":")[0])?a:"f?p="+a+":"+g},R=function(a){var b,c,d,e=a.title,f=a.desc,g=a.path||"",i=a.url,j=a.type,k=a.icon,l=a.shortcut,m=l?'<span class="'+C+'" >'+l+"</span>":"",n="",o=a.peData;if((0===i||i&&i.length>0)&&(n='data-url="'+i+'" '),j&&(n=n+' data-type="'+j+'" '),o)for(b in o)o.hasOwnProperty(b)&&(n=n+" data-"+b+'="'+o[b]+'" ');return j===v.go2App&&a.initials.trim().length>0?(d='<span class="'+k+'" style="color: #fff; box-shadow: 0 0 0 1px #fff;webkit-box-shadow: 0 0 0 1px #fff;position: relative;z-index: 1;margin-right: 16px;padding: 8px;width: 32px;height: 32px;border-radius: 2px;" aria-hidden="true"><span class="a-Icon">'+a.initials+"</span></span>",f=f||"Open Application "+e):d=a.hasCustomIcon?k:'<span class="a-Spotlight-icon" aria-hidden="true"><span class="a-Icon '+k+'"></span></span>',e+=a.alias&&a.alias.trim().length>0?' <span class="a-Spotlight-labelContext">'+a.alias.toLowerCase()+"</span>":"",c='<li class="a-Spotlight-result a-Spotlight-result--page" aria-label="'+f+'"><span class="a-Spotlight-link" '+n+">"+d+'<span class="a-Spotlight-info"><span class="'+E+'" role="option">'+e+'</span><span class="a-Spotlight-desc">'+g.replace("{APP_ID}",h)+"</span></span>"+m+"</span></li>"},S=function(b,d){var h,i=b.data("url"),k=b.data("type");switch(k){case v.pe:f.goToComponent(b.data("typeid"),b.data("componentid"),b.data("propertyid"));break;case v.searchPage:f.activateTab("search"),a("#P4500_LOCAL_SEARCH").val(j).trigger("change").focus();break;case v.searchApp:c.popup({url:"f?p=4000~8000~"+g+"~~~~P8000_START_SEARCH,P8000_SEARCH~1,"+encodeURIComponent(j)+"&p_sep=~",name:"SEARCH_RESULTS",width:1e3,height:800});break;case v.searchAllApps:c.popup({url:"f?p=4000~8000~"+g+"~~~~FB_FLOW_ID,FB_FLOW_PAGE_ID,P8000_START_SEARCH,P8000_SEARCH~,,1,"+encodeURIComponent(j)+"&p_sep=~",name:"SEARCH_RESULTS",width:1e3,height:800});break;case v.go2App:c.redirect("f?p=4000:1:"+g+"::NO::FB_FLOW_ID,F4000_P1_FLOW,P0_FLOWPAGE:"+i+","+i+","+i);break;case v.go2Page:f&&!p?f.goToPage(i):p?c.redirect("f?p=4000:4150:"+g+"::NO::FB_FLOW_ID,FB_FLOW_PAGE_ID:"+o+","+i):c.redirect("f?p=4000:4150:"+g+"::NO::FB_FLOW_PAGE_ID:"+i);break;case v.redirect:c.redirect(Q(i));break;case v.shortcutAction:h=e.lookup(i),h.action||h.href?e.invoke(i,d,N):e.toggle(i)}aa()},T=function(c,d){var e,f,g,h,i,j,k="",l=function(a){return u.getComponentType(a)},m=function(b,c){var d,e,f,g=l(c);if(d=u.displayTitleSearch(b,c),g)for(f=g.childComponentTypes.length,e=0;e<f;e++)d=a.merge(m(b,g.childComponentTypes[e]),d);return d};for(e=m(c,d),e.length>J&&(e.length=J),i=0,j=e.length;i<j;i++)f=e[i],g=f.typeId,h=l(g),k+=R({title:b.escapeHTML(h.title.singular)+" &rarr; "+b.escapeHTML(f.getDisplayTitle()),icon:w.pe,type:v.pe,peData:{typeid:g,componentid:f.id,propertyid:h.displayPropertyId}});return k},U=function(){a("#"+G).empty(),a(x+z).val("").focus(),j="",V(),q&&(q=!1,p=!1,o="")},V=function(){var b=a(x+A),c=a(x+z),d=b.find(x+B).find(x+E).attr("id"),e=a("#"+d),f=e.text(),g=b.find("li"),h=0!==g.length,i="",k=g.filter(function(){return 0===a(this).find(x+C).length}).length;a(x+E).attr("aria-selected","false"),e.attr("aria-selected","true"),""===j?i=P.enterKeywords:0===k?i=P.noMatchFound:1===k?i=P.oneMatchFound:k>1&&(i=O("SL.N.MATCHES.FOUND",k)),i=f+", "+i,a("#"+F).text(i),c.attr("aria-activedescendant",d).attr("aria-expanded",h)},W=function(){var b,c,d,e,f=function(){var f=a("div.a-Spotlight-results");b=f.outerHeight(),c=a("li.a-Spotlight-result").outerHeight(),d=f.offset().top,e=b/c},g=function(a){if(a[0]){var c=a.offset().top;return c<0||c>b}},h=function(a){if(a[0]){var c=a.offset().top;return c>b||c<=d}},k=function(a){var b,d=a.find(x+B),h=d.index();e||f(),!d.length||d.is(":last-child")?(d.removeClass(B),a.find("li").first().addClass(B),a.animate({scrollTop:0})):(b=d.removeClass(B).next().addClass(B),g(b)&&a.animate({scrollTop:(h-e+2)*c},0))},l=function(a){var b,d=a.find(x+B),g=d.index();e||f(),!a.length||d.is(":first-child")?(d.removeClass(B),a.find("li").last().addClass(B),a.animate({scrollTop:a.find("li").length*c})):(b=d.removeClass(B).prev().addClass(B),h(b)&&a.animate({scrollTop:(g-1)*c},0))};a(window).on("apexwindowresized",function(){f()}),a("body").append('<div class="'+y+'"><div class="a-Spotlight-body"><div class="a-Spotlight-search"><div class="a-Spotlight-icon"><span class="a-Icon icon-search" aria-hidden="true"></span></div><div class="a-Spotlight-field"><input type="text" role="combobox" aria-expanded="false" aria-autocomplete="none" aria-haspopup="true" aria-label="Spotlight Search" aria-owns="'+G+'" autocomplete="off" autocorrect="off" spellcheck="false" class="'+z+'" placeholder="'+P.placeHolder+'"></div><div role="region" class="u-VisuallyHidden" aria-live="polite" id="'+F+'"></div></div><div class="'+A+'"><ul class="a-Spotlight-resultsList" id="'+G+'" tabindex="-1" role="listbox"></ul></div></div></div>').on("input",x+z,function(){var b=a(this).val().trim(),c=b.length;0===c?U():(c>1||!isNaN(b))&&b!==j&&da(b)}).on("keydown",x+y,function(b){var c,d,e=a(x+A);switch(b.which){case H.DOWN:b.preventDefault(),k(e);break;case H.UP:b.preventDefault(),l(e);break;case H.ENTER:b.preventDefault(),S(e.find("li.is-active span"),b);break;case H.TAB:aa()}if(b.ctrlKey){switch(c=e.find(x+C).parent().get().reverse(),b.which){case 49:d=1;break;case 50:d=2;break;case 51:d=3;break;case 52:d=4}d&&S(a(c[d-1]),b)}b.shiftKey&&b.which===H.TAB&&aa(),V()}).on("click","span.a-Spotlight-link",function(b){S(a(this),b)}).on("mousemove","li.a-Spotlight-result",function(){var b=a(this);b.parent().find(x+B).removeClass(B),b.addClass(B)}).on("blur",x+y,function(b){a(x+y).dialog("isOpen")&&a(x+z).focus()}),a(x+y).on("keydown",function(b){var c=a(x+z);b.which===H.ESCAPE&&(c.val()?(U(),b.stopPropagation()):aa())}),i=!0},X=function(){l&&l.length>0||a.ajax({dataType:"json",type:"GET",url:s,success:function(a){$(a)},error:function(b,c,d){404==b.status&&a.ajax({dataType:"json",type:"GET",url:r,success:function(a){$(a)},error:function(a,b,c){console.log(JSON.parse(a.responseText))}})}})},Y=function(){m&&m.length>0||apex.server.process("spotlightIndex",{x01:null,x02:"Y"},{success:function(a){m=a},error:function(a,b,c){console.log(JSON.parse(a.responseText))}})},Z=function(a){o=a,apex.server.process("spotlightIndex",{x01:a,x02:"N"},{success:function(a){n=a},error:function(a,b,c){console.log(JSON.parse(a.responseText))}})},$=function(a){var b,c,d,f,g,h="";for(l=a,b=e.list(),g=0;g<b.length;g++)d=b[g],f=d.name,f!==D&&(c=e.lookup(f),c&&(h=e.shortcutDisplay(c.shortcut||"")),l.push({name:d.label,description:h,path:h,shortcutAction:f,priority:0,type:v.shortcutAction}))},_=function(b){var d=function(){var b=a(x+y),d=window.scrollY||window.pageYOffset;b.hasClass("ui-dialog-content")&&b.dialog("isOpen")||b.dialog({width:650,height:"auto",modal:!0,position:{my:"center top",at:"center top+"+(d+64),of:a("body")},dialogClass:"ui-dialog--apexspotlight",open:function(){var b=a(this);b.css("min-height","auto").prev(".ui-dialog-titlebar").remove(),c.beginFreezeScroll(),a(".ui-widget-overlay").on("click",function(){aa()})},close:function(){U(),c.endFreezeScroll()}})};i?(d(),h!=o&&Z(h)):(W(),d(),X(),Y(),h&&h.length>0&&Z(h)),N=b},aa=function(){a(x+y).dialog("close")},ba=function(b){var c,d=encodeURIComponent(j),e=j,f=/^(\d+)(?::|-)\s*(\d+)$/,i=/^(\d+)(?::|-)\s*(s|sc|sh)$/;switch(f.test(j)?(c=j.match(f),b.unshift({name:O("SL.EDIT.PAGE.IN.APP",c[2],c[1]),url:"f?p=4000:4500:"+g+"::NO::FB_FLOW_ID,FB_FLOW_PAGE_ID:"+c[1]+","+c[2],icon:w.page,description:O("APEX.SEARCH.GO_TO_PAGE")+" "+c[2],path:O("APEX.SEARCH.GO_TO_PAGE")+" "+c[2],score:10,priority:10,type:v.redirect})):i.test(j.toLowerCase())&&(c=j.toLowerCase().match(i),b.unshift({name:O("SL.SHARED.COMP.APP",c[1]),url:"f?p=4000:9:"+g+"::NO::FB_FLOW_ID:"+c[1],icon:w.shared,description:O("APEX.SEARCH.GO_TO_SHARED_COMPONENTS"),path:O("APEX.SEARCH.GO_TO_SHARED_COMPONENTS"),score:1e3,priority:100,type:v.redirect})),L){case"builder":(h||u||a(".a-Breadcrumb-item a[href^='f?p=4000:1:']").length>0)&&(u&&b.push({name:O("SL.SEARCH.PAGE",e),type:v.searchPage,icon:w.search,priority:0,shortcut:"Ctrl + 4"}),b.push({name:O("SL.SEARCH.APP",e),type:v.searchApp,icon:w.search,priority:0,shortcut:"Ctrl + 3"}));break;case"teamdev":b.push({name:O("SL.SEARCH.TEAM.DEV",e),url:"f?p=4800:8000:"+g+":::RIR:IR_ROWFILTER:"+d,icon:w.search,priority:0,type:v.redirect});break;case"admin":b.push({name:O("SL.SEARCH.USER",e),url:"f?p=4350:8000:"+g+":::RIR:IR_ROWFILTER:"+d,icon:"icon-user",priority:0,type:v.redirect})}return b.push({name:O("SL.SEARCH.ALLAPPS",e),type:v.searchAllApps,icon:w.search,priority:0,shortcut:"Ctrl + 2"}),b.push({name:O("SL.SEARCH.WP",e),url:"f?p=4500:8000:"+g+":::RIR:IR_ROWFILTER:"+d,icon:w.search,type:v.redirect,priority:0,shortcut:"Ctrl + 1"}),b},ca=function(b){var c,d,e=[],f=!1,i=b.length,k=[],q=!!(h&&h.length>0||p||a(".a-Breadcrumb-item a[href^='f?p=4000:1:']").length>0),r=function(){return k=[],k=q?k.concat(n).concat(m).concat(l):k.concat(m).concat(l),f?e:k},s=function(a,b,c,d){var e,f=100,g=b-1;return 0===a&&0===g?f-d:(e=c.indexOf(j),e===-1?f=f-a-g-b:f-=e,f-d)};for(d=0;d<b.length;d++)c=b[d],e=r().filter(function(a,b){var d=a.name.toLowerCase(),e=d.split(" ").map(function(a){return a[0]}).join(""),f=d.split(" ").length,g=d.search(c),h=0;if(i>f)return!1;if(q&&a.scope&&"app"!==a.scope&&(h=K),g>-1)return a.score=s(g,f,d,h),!0;if(a.tokens){if(a.tokens.search(c)>-1)return a.score=K,!0}else{if(e.search(c)>-1)return a.score=K,!0;if(a.appId){if(a.appId.search(c)>-1)return a.score=s(g,f,a.appId,h),!0}else if(a.pageId){if(a.pageId.search(c)>-1)return a.score=s(g,f,a.pageId,h),!0}else if(a.alias&&a.alias.toLowerCase().search(c)>-1)return a.score=K,!0}}).sort(function(a,b){return b.score-a.score}),f=!0;var t=function(a){var b,c,d,e,f,i,j,k="",l={},m="",n=!1,r="",s={},t="";for(a.sort(function(a,b){return parseInt(b.priority)-parseInt(a.priority)}),a.length>I&&(a.length=I),b=0;b<a.length;b++)if(c=a[b],q||!c.scope||"app"!==c.scope){if(j=c.shortcut,n=!1,r="",c.appId)e=v.go2App,m=c.appId,d="App "+c.appId,i="App "+c.appId,c.appBuilderIconName&&c.appBuilderIconName.trim().length>0?(f='<span class="a-Spotlight-icon">'+c.appBuilderIconName+"</span>",n=!0):c.imageClass&&c.imageClass.trim().length>0?(f='<span class="a-Spotlight-icon '+c.imageClass+'" aria-hidden="true"></span>',n=!0):c.appColor&&c.appColor.trim().length>0&&c.appInitials.trim().length>0?(f=c.appColor,r=c.appInitials):f=w.app;else if(0===c.pageId||c.pageId){if(e=v.go2Page,m=c.pageId,t=c.parentAppId?c.parentAppId:h,!(t&&t.length>0))continue;d=" Go to "+m+" from application ID "+t,i=P.app+" "+t+" &#92; "+P.page+" "+m,f=w.page}else{if(e=c.type||v.redirect,m=c.url||c.shortcutAction,d=c.description,i="",c.path)if("string"==typeof c.path)i=c.path;else{var u=0;for(var x in c.path)c.path.hasOwnProperty(x)&&(i+=c.path[x]+" \\ ",u++);u>=1&&(u-=1),c.scope&&"action"!==c.scope&&c.name!==c.path.last?c.label='<span class="a-Spotlight-labelContext">'+c.path.last+"</span> "+c.name:c.scope&&"action"===c.scope&&(c.label='<span class="a-Spotlight-labelContext">'+c.path.last+"</span> "+c.description,i="");var y=i.split("\\");y=y.slice(0,u),i=y.join("\\")}f=c.icon||w.nav}if(m&&m.length>0){if(m.indexOf("&DEBUG.")>0){var z="::::";p&&(z="::FB_FLOW_ID:"+o),m=m.substring(0,m.indexOf("&DEBUG.")+"&DEBUG.".length).concat(z)}m=m.replace("%SESSION%",g).replace("&DEBUG.","NO").replace("&APP_SESSION.",g)}s={title:c.label?c.label:c.name,desc:d,url:m,icon:f,hasCustomIcon:n,type:e,path:i,score:c.score,alias:c.alias,initials:r,priority:c.priority},j&&(s.shortcut=j),c.score?l[c.score+b]=R(s):j?l[b*-1*100]=R(s):l[b*-1]=R(s)}return Object.keys(l).sort(function(a,b){return b-a}).forEach(function(a){k+=l[a]}),k};return t(ba(e))},da=function(c){var d="sp-result-";j=c.trim();var e,f,g,i,k=j.split(" "),l=(a(x+A),[]),m="",n=new RegExp("^[0-9]+\\s*:\\s*$","gi"),r=new RegExp("^[0-9]+\\s*:(\\s*\\S|\\s*\\d+)","gi"),s=!0;for(n.test(j)?(s=!1,q=!0,i=j.split(":"),i[0].trim().length>0&&(g=i[0],o!==g&&Z(g))):r.test(j)?(s=!0,q=!0,p=!0,i=j.split(":"),i[1].trim().length>0&&(g=i[0],k=i[1].trim().split(" "))):(s=!0,q&&h!==o&&Z(h)),f=0;f<k.length;f++)l.push(new RegExp(b.escapeRegExp(k[f]),"gi"));s||(l=[],j=o),e=ca(l),u&&u.getCurrentPageId()&&!p&&(m=T(l[0],u.COMP_TYPE.PAGE)),a("#"+G).html(m+e).find("li").each(function(b){var c=a(this);c.find(x+E).attr("id",d+b)}).first().addClass(B)};e.add({name:D,label:null,title:null,shortcut:"Ctrl+Quote",action:function(a,b){return _(b),!0}})}(apex.jQuery,apex.util,apex.navigation,apex.lang,apex.actions,window.pageDesigner)});
apex.util=function(a){"use strict";function b(a){return"string"==typeof a?a.replace(/([.$*+\-?(){}|^\[\]\\])/g,"\\$1"):""}function c(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}var d=function(a){return a=""+a,c(a)},e=d,f=new RegExp("(["+b(" !#$%&'()*+,./:;<=>?@[\\]^`{|}~\"")+"])","g"),g=null,h=null,i=null,j=a.isArray,k=1,l={eq:function(a,b){var c;if(j(a)){for(c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}return a===b},neq:function(a,b){return!l.eq(a,b)},"null":function(a){return null===a||""===a||j(a)&&0===a.length},notnull:function(a){return!l["null"](a)},"in":function(a,b){var c;if("string"!=typeof b)return!1;if(b=","+b+",",j(a)){for(c=0;c<a.length;c++)if(b.indexOf(","+a[c]+",")>=0)return!0;return!1}return b.indexOf(","+a+",")>=0},notin:function(a,b){return!l["in"](a,b)}},m={markup:function(a){return this.html+=a,this},attr:function(a,b){return 1===arguments.length&&(b=a,a=null),a&&(this.html+=" "+a+"='"),this.html+=d(b),a&&(this.html+="'"),this},optionalAttr:function(a,b){return b&&"object"!=typeof b&&(this.html+=" "+a+"='"+d(b)+"'"),this},optionalBoolAttr:function(a,b){return b===!0&&(this.html+=" "+a),this},content:function(a){return this.html+=e(a),this},clear:function(){this.html=""},toString:function(){return this.html}},n={debounce:function(a,b){var c;return function(){var d=arguments,e=this;clearTimeout(c),c=setTimeout(function(){c=null,a.apply(e,d)},b)}},toArray:function(b,c){var d,e=[];return"string"==typeof b?(d=void 0===c?":":c,e=b.split(d)):e=a.makeArray(b),e},arrayEqual:function(a,b){var c,d=a.length;if(d!==b.length)return!1;for(c=0;c<d;c++)if(a[c]!==b[c])return!1;return!0},escapeHTML:c,escapeRegExp:b,escapeCSS:function(a){var b="";return a?a.replace(f,"\\$1"):b},htmlBuilder:function(){var a=Object.create(m);return a.clear(),a},makeApplicationUrl:function(a){var b,c="f?p=";if(c+=a.appId||$v("pFlowId"),c+=":",c+=a.pageId||$v("pFlowStepId"),c+=":",c+=a.session||$v("pInstance"),c+=":",c+=a.request||$v("pRequest"),c+=":",c+=a.debug||$v("pdebug")||"",c+=":",c+=a.clearCache||"",c+=":",a.itemNames&&(c+=a.itemNames.join(",")),c+=":",a.itemValues)for(b=0;b<a.itemValues.length;b++)b>0&&(c+=","),c+=encodeURIComponent(a.itemValues[b]);return c+=":",c+=a.printerFriendly||""},showSpinner:function(b,c){var d,e,f,g,h,i,j=n.htmlBuilder(),k=a.extend({alert:apex.lang.getMessage("APEX.PROCESSING"),spinnerClass:""},c),l=a(b&&!k.fixed?b:"body"),m=a(window),o=l.offset(),p={top:m.scrollTop(),left:m.scrollLeft()};return j.markup("<span").attr("class","u-Processing"+(k.spinnerClass?" "+k.spinnerClass:"")).attr("role","alert").markup(">").markup("<span").attr("class","u-Processing-spinner").markup(">").markup("</span>").markup("<span").attr("class","u-VisuallyHidden").markup(">").content(k.alert).markup("</span>").markup("</span>"),d=a(j.toString()),d.appendTo(l),k.fixed?(f=(m.height()-d.height())/2,e=(m.width()-d.width())/2,d.css({position:"fixed",top:f+"px",left:e+"px"})):(p.bottom=p.top+m.height(),p.right=p.left+m.width(),o.bottom=o.top+l.outerHeight(),o.right=o.left+l.outerWidth(),f=o.top>p.top?o.top:p.top,g=o.bottom<p.bottom?o.bottom:p.bottom,h=(g-f)/2,i=p.top-o.top,i>0&&(h+=i),d.position({my:"center",at:"left+50% top+"+h+"px",of:l,collision:"fit"})),d},delayLinger:function(){function a(a){var b=c[a];return b||(b={count:0,timer:null},c[a]=b),b}function b(a){delete c[a]}var c={},d=200,e=1e3,f={start:function(b,c){var e=a(b);e.count+=1,1!==e.count||null!==e.timer||e.showing||(e.start=(new Date).getTime(),e.timer=setTimeout(function(){e.timer=null,e.showing=!0,c()},d))},finish:function(c,d){var f,g=a(c);if(0===g.count)throw new Error("delayLinger.finish called before start for scope "+c);f=(new Date).getTime()-g.start,g.count-=1,0===g.count&&(null===g.timer?f<e?setTimeout(function(){0===g.count&&(g.showing=!1,d(),b(c))},e-f):(g.showing=!1,d(),b(c)):(clearTimeout(g.timer),g.timer=null,b(c)))}};return f}(),setOuterHeight:function(b,c){a.each(["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom","marginTop","marginBottom"],function(a,d){var e=parseInt(b.css(d),10);isNaN(e)||(c-=e)}),b.height(c)},setOuterWidth:function(b,c){a.each(["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight","marginLeft","marginRight"],function(a,d){var e=parseInt(b.css(d),10);isNaN(e)||(c-=e)}),b.width(c)},getDateFromISO8601String:function(a){var b,c,d,e,f=0,g=0,h=0,i=0,j=/^(\d\d\d\d)-(\d\d)-(\d\d)(T(\d\d):(\d\d)(:(\d\d)(.(\d\d\d))?)?Z?)?$/.exec(a);if(!j)throw new Error("Invalid date format");return c=parseInt(j[1],10),d=parseInt(j[2],10)-1,e=parseInt(j[3],10),j[5]&&(f=parseInt(j[5],10),g=parseInt(j[6],10),j[8]&&(h=parseInt(j[8],10),j[10]&&(i=parseInt(j[10],10)))),b=new Date(Date.UTC(c,d,e,f,g,h,i))},getTopApex:function(){function a(a){var b;try{b=a.apex||null}catch(c){b=null}return b}var b,c;if(null!==i)return i;if(i=a(top),null!==i)return i;for(b=window;c=a(b),null!==c&&b.parent&&b.parent!==b;)i=c,b=b.parent;return i},getScrollbarSize:function(){var b;return null===g&&(b=a("<div>").css({width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}).appendTo("body"),g={width:b[0].offsetWidth-b[0].clientWidth,height:b[0].offsetHeight-b[0].clientHeight},b.remove()),g},invokeAfterPaint:(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,0)}).bind(window),cancelInvokeAfterPaint:(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||function(a){return window.clearTimeout(a)}).bind(window),stripHTML:function(a){for(var b=/<[^<>]+>/;b.exec(a);)a=a.replace(b,"");return a},getNestedObject:function(a,b){var c=a;return b.length>0&&b.split(".").forEach(function(a){void 0===c[a]&&(c[a]={}),c=c[a]}),c},checkCondition:function(a,b){var c,d,e,f;if(b=b||{},a.item){if(c=apex.item(a.item),!c.node)return apex.debug.warn("No such item: ",a.item),!1;d=c.getValue(),b.multiValued&&!j(d)&&""!==d&&(d=d.split(":"))}return void 0!==a.value&&(e=a.value,b.doSubstitution&&e.match(/[#&]/)&&(e=n.applyTemplate(e,b))),void 0!==a.value2&&(f=a.value2,b.doSubstitution&&f.match(/[#&]/)&&(f=n.applyTemplate(f,b))),!!l[a.op](d,e,f)},watchCondition:function(b,c,d){var e,f,g="watchCond"+k;if(k+=1,c=c||{},b.item){if(e=apex.item(b.item),!e.node)return void apex.debug.warn("No such item: ",b.item);a(e.node).on("change."+g,function(){var a=apex.item(b.item),e=a.getValue();e!==f&&(f=e,d(n.checkCondition(b,c)))})}return d(n.checkCondition(b,c)),g},unwatchCondition:function(b,c){var d;if(b.item){if(d=apex.item(b.item),!d.node)return;a(d.node).off("change."+c)}},applyTemplate:function(b,e){function f(a){return a.replace(p,function(a,b,f,g,i,j){var k,l,o,p,q,u,v,w,x,y,z,A,B=null,C=e.defaultEscapeFilter,D=null;if(g&&(f=g),f){if(0===f.indexOf("APP_TEXT$")&&(z=f.substr(9),A=r.exec(z),A&&(A[0].length>1&&apex.debug.warn("applyTemplate message text substitution "+A[0]+" language ignored."),z=z.replace(r,"")),z&&(D=apex.lang.getMessage(z))),null===D&&e.includePageItems&&(l=t(f),l.node&&(D=l.getValue(),D=l.displayValueFor(D))),null===D&&e.model&&e.record){for(o=e.model,p=e.record,v=[];null===D&&p&&o;)D=o.getValue(p,f)||null,p=null,null===D?(x=m.exec(f),x&&(y=x[1],w=o.getOption("fields"),w.hasOwnProperty(y)&&(D=w[y].label||w[y].heading||null)),null===D&&(q=o.getOption("parentModel"),u=o.getOption("parentRecordId"),q&&u&&(o=s.get(q),o&&(v.push(q),p=o.getRecord(u))))):(w=o.getOption("fields"),w[f].hasOwnProperty("escape")&&(C=w[f].escape?"HTML":"RAW"),w[f].hasOwnProperty("elementId")&&(B=w[f].elementId));for(k=0;k<v.length;k++)s.release(v[k])}if(null===D&&e.includeBuiltinSubstitutions&&(D=h[f]||null),null===D&&e.extraSubstitutions&&(D=e.extraSubstitutions[f]||null),null===D)D="";else if("object"==typeof D&&D.hasOwnProperty("d")?D=D.d:B&&(l=t(B),l.node&&(D=l.displayValueFor(D))),j||(j=C),"HTML"===j)D=c(D);else if("ATTR"===j)D=d(D);else if("STRIPHTML"===j)D=c(n.stripHTML(D.replace("&nbsp;","")));else if("RAW"!==j&&j)throw new Error("Invalid template filter: "+j)}else D="";return D})}var g,i,j,k,l,m=/^(.+)_LABEL$/,o=/#([_$A-Z0-9]+)#/,p=/&(([A-Z0-9_$#]+)|"([^"&\r\n]+)")(!([A-Z]+))?\./g,q=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script\s*>/gi,r=/\$[^$]*$/,s=apex.model,t=apex.item;if(e=a.extend({placeholders:null,defaultEscapeFilter:"HTML",includePageItems:!0,model:null,record:null,extraSubstitutions:null,includeBuiltinSubstitutions:!0},e||{}),!h&&e.includeBuiltinSubstitutions&&(h={APP_ID:$v("pFlowId"),APP_PAGE_ID:$v("pFlowStepId"),APP_SESSION:$v("pInstance"),REQUEST:$v("pRequest"),DEBUG:$v("pdebug"),IMAGE_PREFIX:window.apex_img_dir||""}),e.placeholders){for(g="",i=b,j=i.search(o);j>=0;)k=i.match(o)[1],l=e.placeholders[k],l?(g+=f(i.substring(0,j))+l,i=i.substring(j+k.length+2)):(g+=f(i.substring(0,j+k.length+1)),i=i.substring(j+k.length+1)),j=i.search(o);g+=f(i)}else g=f(b);for(;q.test(g);)g=g.replace(q,"");return g}};return n.escapeHTMLContent=e,n.escapeHTMLAttr=d,n}(apex.jQuery);